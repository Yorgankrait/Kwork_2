#!/usr/bin/env python
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON —Å –ø–æ–ª–Ω—ã–º–∏ –∏ –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
"""
import requests
import json
import time

BASE_URL = "http://127.0.0.1:8000"

def test_create_smeta(data_json, test_name):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç—ã —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º JSON"""
    url = f"{BASE_URL}/api/smeta_create/"
    # –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
    payload = {"–î–∞–Ω–Ω—ã–µ": json.dumps(data_json)}
    
    print(f"\n=== –¢–µ—Å—Ç: {test_name} ===")
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:")
    print(json.dumps(data_json, indent=2, ensure_ascii=False))
    
    try:
        response = requests.post(url, json=payload)
        
        print(f"–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
        print(f"–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞: {response.text}")
        
        if response.status_code == 201:
            print(f"‚úÖ –°–º–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!")
            print(f"üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–º–µ—Ç—É: {response.text}")
            return response.text
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–º–µ—Ç—ã")
            return None
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞: {str(e)}")
        return None

# –¢–µ—Å—Ç 1: –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–º–µ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
valid_data = {
    "–ù–æ–º–µ—Ä": "Test-01-Full",
    "–û—Ñ–∏—Å": {
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ü—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞", 
        "–ê–¥—Ä–µ—Å": "–≥. –ú–æ—Å–∫–≤–∞, –ø—Ä-—Ç. –ú–∏—Ä–∞, 103"
    },
    "–ú–µ–Ω–µ–¥–∂–µ—Ä": {
        "–ò–º—è": "–î–º–∏—Ç—Ä–∏–π –ö–æ–Ω–æ–Ω–µ–Ω–∫–æ", 
        "–¢–µ–ª–µ—Ñ–æ–Ω": "+7 (495) 545-00-85"
    },
    "–¶–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è": 389319,
    "–¶–µ–Ω–∞ –Ω–æ–≤–∞—è": 286400,
    "–ò–∑–¥–µ–ª–∏—è": [
        {
            "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä": 1,
            "–°–∏—Å—Ç–µ–º–∞": "–õ—é–º–æ",
            "–°–µ—Ä–∏—è": "–ö–æ–º—Ñ–æ—Ä—Ç",
            "–®–∏—Ä–∏–Ω–∞": 1520,
            "–í—ã—Å–æ—Ç–∞": 1950,
            "–¶–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω–µ—à–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–†—É—á–∫–∏": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ",
            "–û–ø—Ü–∏–∏": [
                {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ú–æ—Å–∫–∏—Ç–Ω–∞—è —Å–µ—Ç–∫–∞"}
            ],
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 4,
            "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ": "iVBORw0KGgoAAAANSUhEUgAAAR...",
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 0
        },
        {
            "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä": 2,
            "–°–∏—Å—Ç–µ–º–∞": "–õ—é–º–æ",
            "–°–µ—Ä–∏—è": "–ö–æ–º—Ñ–æ—Ä—Ç",
            "–®–∏—Ä–∏–Ω–∞": 1520,
            "–í—ã—Å–æ—Ç–∞": 1910,
            "–¶–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω–µ—à–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–†—É—á–∫–∏": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ",
            "–û–ø—Ü–∏–∏": [],
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 1,
            "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ": "iVBORw0KGgoAAAANSUhEUgAAAR...",
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 0
        }
    ],
    "–î–æ–ø—ã": [
        {
            "–ù–∞–∑–≤–∞–Ω–∏–µ": "–û—Ç–ª–∏–≤—ã",
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 5,
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 4092
        }
    ],
    "–£—Å–ª—É–≥–∏": [
        {
            "–ù–∞–∑–≤–∞–Ω–∏–µ": "–î–æ—Å—Ç–∞–≤–∫–∞ –∏–∑–¥–µ–ª–∏–π",
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 350
        },
        {
            "–ù–∞–∑–≤–∞–Ω–∏–µ": "–ú–æ–Ω—Ç–∞–∂ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞",
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 55450
        },
        {
            "–ù–∞–∑–≤–∞–Ω–∏–µ": "–í—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞ 5 –∏–∑–¥. (–∫–∏—Ä–ø–∏—á–Ω—ã–π)",
            "–°—Ç–æ–∏–º–æ—Å—Ç—å": 0
        }
    ]
}

# –¢–µ—Å—Ç 2: –ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –æ—à–∏–±–∫–∞–º–∏, –Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
invalid_data = {
    "–ù–æ–º–µ—Ä": "Test-02-Partial",
    "–û—Ñ–∏—Å": {
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ü—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞",
        "–ê–¥—Ä–µ—Å": "–≥. –ú–æ—Å–∫–≤–∞, –ø—Ä-—Ç. –ú–∏—Ä–∞, 103"
    },
    "–ú–µ–Ω–µ–¥–∂–µ—Ä": {
        "–ò–º—è": "–î–º–∏—Ç—Ä–∏–π –ö–æ–Ω–æ–Ω–µ–Ω–∫–æ",
        "–¢–µ–ª–µ—Ñ–æ–Ω": "+7 (495) 545-00-85"
    },
    "–¶–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è": 389319,
    "–¶–µ–Ω–∞ –Ω–æ–≤–∞—è": 286400,
    "–ò–∑–¥–µ–ª–∏—è": [
        {
            "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä": 1,
            "–°–∏—Å—Ç–µ–º–∞": "–õ—é–º–æ",
            "–°–µ—Ä–∏—è": "–ö–æ–º—Ñ–æ—Ä—Ç",
            "–®–∏—Ä–∏–Ω–∞": 1520,
            "–í—ã—Å–æ—Ç–∞": 1950,
            "–¶–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–¶–≤–µ—Ç –≤–Ω–µ—à–Ω–∏–π": "–ë–µ–ª—ã–π",
            "–û–ø—Ü–∏–∏": [],
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 4,
            "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ": "iVBORw0KGgoAAAANSUhEUgAAAR..."
        }
    ]
}

if __name__ == "__main__":
    print("üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è —Å–º–µ—Ç")
    
    # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –æ–∂–∏–¥–∞—è –Ω–µ–º–Ω–æ–≥–æ
    print("‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞...")
    try:
        response = requests.get(f"{BASE_URL}/admin/")
        if response.status_code < 500:
            print("‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω")
        else:
            print("‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É")
            exit(1)
    except:
        print("‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Django.")
        print("   –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: python run_local.py")
        exit(1)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    url1 = test_create_smeta(valid_data, "–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON")
    
    # –î–µ–ª–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    time.sleep(1)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    url2 = test_create_smeta(invalid_data, "–ù–µ–ø–æ–ª–Ω—ã–π JSON —Å –æ—à–∏–±–∫–∞–º–∏")
    
    print("\n=== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===")
    print("–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–∞–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ:")
    if url1:
        print(f"1. –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {url1}")
    if url2:
        print(f"2. –ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {url2}")
    
    print("\n–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ:")
    print(f"- –ê–¥–º–∏–Ω–∫–∞: {BASE_URL}/admin/")
    print("- –†–∞–∑–¥–µ–ª RawJSON –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏—Å—Ö–æ–¥–Ω—ã—Ö JSON")
    print("- –†–∞–∑–¥–µ–ª Order –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤")
    print("- –§–∞–π–ª –ª–æ–≥–æ–≤ –≤ logs_dev/app.log –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫") 